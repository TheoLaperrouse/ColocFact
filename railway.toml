[build]
builder = "nixpacks"

[build.nixpacks]
plan = """
[phases.setup]
nixPkgs = ['nodejs_20']

[phases.install]
cmds = ['cd client && npm ci', 'cd server && npm ci']

[phases.build]
cmds = ['cd client && npm run build']
"""

[deploy]
startCommand = "cd server && npm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
